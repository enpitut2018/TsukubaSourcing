<%= link_to '<<Back', jobs_path %>
<div class="row">
  <div class="col s12 m6">
    <div class="card">
      <div class="card-content">
        <div class="card-title">
          <span><%= @job.title %></span>
          <div class="chip"><%= User.find_by(id: @job.user_id).name %></div>
        </div>
        <p><%= @job.description%></p>
      </div>
      <div class="card-action">
        <% if user_signed_in? %>
        <% if current_user.id == @job.user_id %>
          <%= link_to 'Edit', edit_job_path(@job) %>
        <% end %>
        <% end %>
        <%= link_to 'Back', jobs_path %>
      </div>
    </div>
  </div>
</div>

<div class="card">
  <div class="card-tabs">
    <ul class="tabs tabs-fixed-width">
      <li class="tab"><a class="active" href="#comment">Comment</a></li>
      <li class="tab"><a href="#chat">Chat</a></li>
      <li class="tab"><a href="#userlist">UserList</a></li>
    </ul>
  </div>
  <div class="card-content grey lighten-4">
    <div id="comment">

      <table>
        <thead>
          <tr>
            <th>User</th>
            <th>Message</th>
            <th style="text-align:right">Date</th>
          </tr>
        </thead>

        <tbody>
          <% @comments.each do |comment| %>
            <% if comment.visible==true %>
              <tr>
                <td><%= "#{User.find_by(id: comment.user_id).name.to_s}" %></td>
                <td><%= comment.message %></td>
                <td style="text-align:right"><%= comment.created_at.to_s.slice(0,19) %></td>
                <!--    <td><%#= link_to 'Show', comment %></td>
                <td><%#= link_to 'Edit', edit_comment_path(comment) %></td>
                <td><%#= link_to 'Destroy', comment, method: :delete, data: { confirm: 'Are you sure?' } %></td> -->
              </tr>
            <% end %>
          <% end %>
        </tbody>
      </table>

      <br>

      <% if user_signed_in? %>
      <%= form_tag({ :controller => 'jobs', :action => 'create_comment'},{ :method => :post}) do %>
      <%= text_field_tag :message %>
      <%= hidden_field_tag :user_id, current_user.id %>
      <%= hidden_field_tag :job_id, @job.id %>
      <%= submit_tag "Send", :class=> "waves-effect waves-light btn" %>
      <% end %>
      <% end %>
    </div>
    <div id="chat">
      <% if not user_signed_in? %>
      <% elsif current_user.id == @job.user_id %>
        <%= button_to "問い合わせ一覧", worker_list_job_path(@job), method: :get, :class=> "waves-effect waves-light btn" %>
      <% else %>
        <ul class="collection">
      <% @chat_list.each do |chat| %>
        <% side ="text-align:"+ (current_user.id==chat.from_id ? "right" : "left" ) %>
        <li class="collection-item" style= <%= side %> >
          <span class="title" ><%= "#{User.find_by(id: chat.from_id).name.to_s} #{chat.created_at.to_s.slice(0,19)}" %></span><br/>
          <span ><%= chat.message %></span>
        </li>
      <% end %>
  </ul>
      
        <%= form_tag({ :controller => 'jobs', :action => 'create_message'},{ :method => :post}) do %>
          <%= label "Message", :message %>
          <%= text_field_tag :message %>
          <%= hidden_field_tag :from_id, current_user.id %>
          <%= hidden_field_tag :to_id, @employer.id %>
          <%= submit_tag "Send", :class=>"waves-effect waves-light btn" %>
        <% end %>
      <% end %>
    </div>
    <div id="userlist">
      User List
    </div>
  </div>
</div>
